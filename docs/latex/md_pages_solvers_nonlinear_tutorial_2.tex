

\begin{DoxyParagraph}{}
This tutorial demonstrates how to use the Newton-\/\+Raphson solver from pressio/solvers\+\_\+nonlinear using custom data types.
\end{DoxyParagraph}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md31}{}\doxysection{Custom data types}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md31}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include <array>}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct }MyCustomVector\{}
\DoxyCodeLine{  \textcolor{keywordtype}{double} \& operator[](\textcolor{keywordtype}{int} i)\{ \textcolor{keywordflow}{return} d\_[i]; \}}
\DoxyCodeLine{  \textcolor{keyword}{const} \textcolor{keywordtype}{double} \& operator[](\textcolor{keywordtype}{int} i)\textcolor{keyword}{const }\{ \textcolor{keywordflow}{return} d\_[i]; \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} fill(\textcolor{keywordtype}{double} value)\{ d\_.fill(value); \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{  std::array<double, 2> d\_ = \{\};}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{struct }MyCustomMatrix\{}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{double} \& operator()(\textcolor{keywordtype}{int} i, \textcolor{keywordtype}{int} j)\{ \textcolor{keywordflow}{return} d\_[2*i+j]; \}}
\DoxyCodeLine{  \textcolor{keyword}{const} \textcolor{keywordtype}{double} \& operator()(\textcolor{keywordtype}{int} i, \textcolor{keywordtype}{int} j)\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} d\_[2*i+j]; \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} fill(\textcolor{keywordtype}{double} value)\{ d\_.fill(value); \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{  std::array<double, 4> d\_ = \{\};}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md32}{}\doxysection{Problem class}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md32}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct }MySystem}
\DoxyCodeLine{\{}
\DoxyCodeLine{  \textcolor{keyword}{using} scalar\_type = double;}
\DoxyCodeLine{  \textcolor{keyword}{using} state\_type = MyCustomVector;}
\DoxyCodeLine{  \textcolor{keyword}{using} residual\_type = state\_type;}
\DoxyCodeLine{  \textcolor{keyword}{using} jacobian\_type = MyCustomMatrix;}
\DoxyCodeLine{}
\DoxyCodeLine{  residual\_type createResidual()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \{\}; \}}
\DoxyCodeLine{  jacobian\_type createJacobian()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} \{\}; \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} residual(\textcolor{keyword}{const} state\_type\& x,}
\DoxyCodeLine{                residual\_type\& res)\textcolor{keyword}{ const}}
\DoxyCodeLine{\textcolor{keyword}{  }\{}
\DoxyCodeLine{    res[0] =  x[0]*x[0]*x[0] + x[1] -\/ 1.0;}
\DoxyCodeLine{    res[1] = -\/x[0] + x[1]*x[1]*x[1] + 1.0;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} jacobian(\textcolor{keyword}{const} state\_type\& x, jacobian\_type\& J)\textcolor{keyword}{ const}}
\DoxyCodeLine{\textcolor{keyword}{  }\{}
\DoxyCodeLine{    J(0,0) = 3.0*x[0]*x[0];}
\DoxyCodeLine{    J(0,1) =  1.0;}
\DoxyCodeLine{    J(1,0) = -\/1.0;}
\DoxyCodeLine{    J(1,1) = 3.0*x[1]*x[1];}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md33}{}\doxysection{Specialize trait and ops}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md33}
Because we are working with custom data types, we need to provide the necessary operations to do the algebra that pressio needs. This is done via specialization as follows\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{preprocessor}{\#include "{}pressio/type\_traits.hpp"{}}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{namespace }pressio\{}
\DoxyCodeLine{\textcolor{keyword}{template}<> \textcolor{keyword}{struct }Traits<MyCustomVector>\{}
\DoxyCodeLine{  \textcolor{keyword}{using} scalar\_type = double;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{template}<> \textcolor{keyword}{struct }Traits<MyCustomMatrix>\{}
\DoxyCodeLine{  \textcolor{keyword}{using} scalar\_type = double;}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{namespace }ops\{}
\DoxyCodeLine{MyCustomVector clone(\textcolor{keyword}{const} MyCustomVector \& src)\{ \textcolor{keywordflow}{return} src; \}}
\DoxyCodeLine{MyCustomMatrix clone(\textcolor{keyword}{const} MyCustomMatrix \& src)\{ \textcolor{keywordflow}{return} src; \}}
\DoxyCodeLine{\textcolor{keywordtype}{void} set\_zero(MyCustomVector \& o)\{ o.fill(0); \}}
\DoxyCodeLine{\textcolor{keywordtype}{void} set\_zero(MyCustomMatrix \& o)\{ o.fill(0); \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{double} norm2(\textcolor{keyword}{const} MyCustomVector \& v)\{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} std::sqrt(v[0]*v[0] + v[1]*v[1]);}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void} update(MyCustomVector \& v, \textcolor{keywordtype}{double} a,}
\DoxyCodeLine{        \textcolor{keyword}{const} MyCustomVector \& v1, \textcolor{keywordtype}{double} b)\{}
\DoxyCodeLine{  v[0] = v[0]*a + b*v1[0];}
\DoxyCodeLine{  v[1] = v[1]*a + b*v1[1];}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keywordtype}{void} scale(MyCustomVector \& v, \textcolor{keywordtype}{double} factor)\{}
\DoxyCodeLine{  v[0] = v[0]*factor;}
\DoxyCodeLine{  v[1] = v[1]*factor;}
\DoxyCodeLine{\}}
\DoxyCodeLine{\}\}\textcolor{comment}{//end namespace pressio::ops}}

\end{DoxyCode}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md34}{}\doxysection{Custom Linear solver}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md34}
In this example, we use a custom linear solver.


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{struct }LinearSolver\{}
\DoxyCodeLine{  \textcolor{keyword}{using} matrix\_type = MyCustomMatrix;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordtype}{void} solve(\textcolor{keyword}{const} matrix\_type \& M, \textcolor{keyword}{const} MyCustomVector \& rhs, MyCustomVector \& x)}
\DoxyCodeLine{  \{}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{auto} a = M(0,0);}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{auto} b = M(0,1);}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{auto} c = M(1,0);}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{auto} d = M(1,1);}
\DoxyCodeLine{    \textcolor{keyword}{const} \textcolor{keyword}{auto} det = a*d -\/ b*c;}
\DoxyCodeLine{}
\DoxyCodeLine{    x[0] = (d*rhs[0]  -\/ b*rhs[1])/det;}
\DoxyCodeLine{    x[1] = (-\/c*rhs[0] + a*rhs[1])/det;}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md35}{}\doxysection{Main}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md35}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} main()}
\DoxyCodeLine{\{}
\DoxyCodeLine{  \textcolor{keyword}{namespace }plog   = pressio::log;}
\DoxyCodeLine{  \textcolor{keyword}{namespace }pnonls = pressio::nonlinearsolvers;}
\DoxyCodeLine{}
\DoxyCodeLine{  plog::initialize(pressio::logto::terminal);}
\DoxyCodeLine{  plog::setVerbosity(\{plog::level::info\});}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{using} problem\_t  = MySystem;}
\DoxyCodeLine{  \textcolor{keyword}{using} state\_t    = problem\_t::state\_type;}
\DoxyCodeLine{  problem\_t sys;}
\DoxyCodeLine{  state\_t y;}
\DoxyCodeLine{  y[0] = 0.001;}
\DoxyCodeLine{  y[1] = -\/0.1;}
\DoxyCodeLine{}
\DoxyCodeLine{  LinearSolver linearSolverObj;}
\DoxyCodeLine{  \textcolor{keyword}{auto} nonLinSolver = pnonls::create\_newton\_raphson(sys, y, linearSolverObj);}
\DoxyCodeLine{  nonLinSolver.solve(sys, y);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// check solution}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"{}Computed solution: ["{}}}
\DoxyCodeLine{            << y[0] << \textcolor{stringliteral}{"{} "{}} << y[1] << \textcolor{stringliteral}{"{} "{}} << \textcolor{stringliteral}{"{}] "{}}}
\DoxyCodeLine{            << \textcolor{stringliteral}{"{}Expected solution: [1., 0.] "{}}}
\DoxyCodeLine{            << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{  plog::finalize();}
\DoxyCodeLine{  \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md_pages_solvers_nonlinear_tutorial_2_autotoc_md36}{}\doxysection{Full Code}\label{md_pages_solvers_nonlinear_tutorial_2_autotoc_md36}
The full code is available TODO. 
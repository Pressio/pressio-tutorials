

\begin{DoxyParagraph}{}
This tutorial shows how to create a linear decoder object when using data types that are known to pressio. Recall that a linear decoder represents a mapping of the form\+: \[ {\mathbf y}_{fom} = \mathbf{\phi} {\mathbf y}_{rom} \] where $\mathbf{\phi}$ is a matrix (for now assumed constant), $\mathbf{y}_{rom}$ is the reduced state (or generalized coordinates), and $\mathbf{y}_{fom}$ is the full-\/order model (FOM) state. A linear decoder is thus fully defined by its Jacobian matrix.
\end{DoxyParagraph}
\hypertarget{md_pages_rom_tutorial_lindec_autotoc_md20}{}\doxysection{Types Description}\label{md_pages_rom_tutorial_lindec_autotoc_md20}

\begin{DoxyItemize}
\item $\mathbf{y}_{fom}$\+: this is the FOM state and, therefore, it is a data structure of your application. For example, if your application uses Trilinos/\+Tpetra, the FOM state can be, e.\+g., a Tpetra vector. Typically, $y_{fom}$ is a large (distributed) vector.
\item $\mathbf{\phi}$\+: this is the (dense) matrix of this linear mapping (for ROMs, this can be, e.\+g., POD modes). This should also be a data structure from your application. For example, if you are using Trilinos/\+Tpetra, this matrix can be, e.\+g., a Tpetra Multi\+Vector. Typically, $\phi$ is a large (distributed) dense matrix.
\item $\mathbf{y}_{rom}$\+: this is the ROM state. ROM data strutures generally involve small, dense operators that fit well on a single node. In pressio, {\itshape regardless of what the FOM types are}, the data types of the ROM operators are pressio wrappers of either Eigen (always enabled) or Kokkos (optional dependency) types. The user can choose which one to use. The reason of this choice is that ROM operators are always small and dense and fit well on a single node, as explained \mbox{[}here\mbox{]}(todo).
\end{DoxyItemize}

For demonstration purposes, here we use Eigen types for the FOM. For other types already known to pressio, this would work similarly.\hypertarget{md_pages_rom_tutorial_lindec_autotoc_md21}{}\doxysection{Main function}\label{md_pages_rom_tutorial_lindec_autotoc_md21}

\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"{}Running tutorial\(\backslash\)n"{}};}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{using} native\_fom\_state\_t = Eigen::VectorXd;}
\DoxyCodeLine{  \textcolor{keyword}{using} native\_phi\_t       = Eigen::MatrixXd;}
\DoxyCodeLine{  \textcolor{comment}{// wrap native types with pressio containers}}
\DoxyCodeLine{  \textcolor{keyword}{using} fom\_state\_t = pressio::containers::Vector<native\_fom\_state\_t>;}
\DoxyCodeLine{  \textcolor{keyword}{using} phi\_t       = pressio::containers::DenseMatrix<native\_phi\_t>;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// create native phi, and for simplicity fill with ones}}
\DoxyCodeLine{  native\_phi\_t phiNative(6, 3);}
\DoxyCodeLine{  phiNative.setConstant(1.);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// construct linear decoder}}
\DoxyCodeLine{  \textcolor{keyword}{using} decoder\_t = pressio::rom::LinearDecoder<phi\_t, fom\_state\_t>;}
\DoxyCodeLine{  decoder\_t decoder(std::move(phiNative));}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// construct the reduced state, fill with 2s}}
\DoxyCodeLine{  \textcolor{keyword}{using} rom\_state\_t = pressio::containers::Vector<Eigen::VectorXd>;}
\DoxyCodeLine{  rom\_state\_t yRom(3);}
\DoxyCodeLine{  pressio::ops::fill(yRom, 2.);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// apply mapping: computes yFom = phi yRom}}
\DoxyCodeLine{  fom\_state\_t yFom(6);}
\DoxyCodeLine{  decoder.applyMapping(yRom, yFom);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// check}}
\DoxyCodeLine{  \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} i=0; i<yFom.extent(0); ++i)}
\DoxyCodeLine{    std::cout << \textcolor{stringliteral}{"{}i= "{}} << i}
\DoxyCodeLine{          << \textcolor{stringliteral}{"{}, yFom(i) = "{}}  << yFom(i)}
\DoxyCodeLine{          << \textcolor{stringliteral}{"{}, expected = "{}} << 6.}
\DoxyCodeLine{          << \textcolor{stringliteral}{"{}\(\backslash\)n"{}};}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}

\end{DoxyCode}
\hypertarget{md_pages_rom_tutorial_lindec_autotoc_md22}{}\doxysection{Code Breakdown}\label{md_pages_rom_tutorial_lindec_autotoc_md22}
The main function starts with type aliasing\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} native\_fom\_state\_t = Eigen::VectorXd;}
\DoxyCodeLine{\textcolor{keyword}{using} native\_phi\_t       = Eigen::MatrixXd;}
\DoxyCodeLine{\textcolor{comment}{// wrap native types with pressio containers}}
\DoxyCodeLine{\textcolor{keyword}{using} fom\_state\_t = pressio::containers::Vector<native\_fom\_state\_t>;}
\DoxyCodeLine{\textcolor{keyword}{using} phi\_t       = pressio::containers::DenseMatrix<native\_phi\_t>;}

\end{DoxyCode}
 where we explictly create pressio wrapper types for the FOM state and decoder Jacobian $\phi$. This is needed because pressio operates on these wrapper types.

We then create a native matrix\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// create native phi, and for simplicity fill with ones}}
\DoxyCodeLine{native\_phi\_t phiNative(6, 3);}
\DoxyCodeLine{phiNative.setConstant(1.);}

\end{DoxyCode}
 Note that this is a native type, so in this case Eigen.

The decoder object is instantiated here\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{using} decoder\_t = pressio::rom::LinearDecoder<phi\_t, fom\_state\_t>;}
\DoxyCodeLine{decoder\_t decoder(std::move(phiNative));}

\end{DoxyCode}
 Note that the native object {\ttfamily phi\+Native} is moved from (since Eigen supports move semantics) to avoid a deep copy. After the move, {\ttfamily phi\+Native} is left in undefined state, so it should not be used. One can also do {\ttfamily decoder(phi\+Native)} which implies a deep copy of the matrix, and obviously, if the matrix is large avoiding a copy is useful.

To perform the computation, the {\ttfamily Linear\+Decoder} class exposes an {\ttfamily apply\+Mapping} method\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// apply mapping: computes yFom = phi yRom}}
\DoxyCodeLine{fom\_state\_t yFom(6);}
\DoxyCodeLine{decoder.applyMapping(yRom, yFom);}

\end{DoxyCode}
\hypertarget{md_pages_rom_tutorial_lindec_autotoc_md23}{}\doxysection{Full Code}\label{md_pages_rom_tutorial_lindec_autotoc_md23}
The full tutorial can be found \href{https://github.com/Pressio/pressio-tutorials/blob/master/tutorials/tut_rom_1.cc}{\texttt{ here}}. 


\begin{DoxyParagraph}{}
This tutorial demonstrates how to use the pressio/ode component to run explicit time integration for a system of ODEs based on custom types, i.\+e. data types that pressio does not know how to operate on. As mentioned in tutorial1, pressio can handle types for which it has wrappers as well as unknown arbitrary types. While in the former case pressio knows how to do linear algebra, in the latter pressio does not know which methods those data structures support. These operations can be passed to pressio via objects as shown below.
\end{DoxyParagraph}
\hypertarget{md_pages_ode_tutorial2_autotoc_md9}{}\doxysection{Custom Vector Class}\label{md_pages_ode_tutorial2_autotoc_md9}
For the sake of this tutorial, we suppose that you have an application that uses a custom vector class as follows\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} scalar\_t>}
\DoxyCodeLine{\textcolor{keyword}{struct }MyCustomVector}
\DoxyCodeLine{\{}
\DoxyCodeLine{  \textcolor{keyword}{using} value\_type = scalar\_t;}
\DoxyCodeLine{  \textcolor{keyword}{using} size\_type = std::size\_t;}
\DoxyCodeLine{}
\DoxyCodeLine{  MyCustomVector(std::size\_t sizeIn)}
\DoxyCodeLine{    : m\_data(sizeIn)\{\}}
\DoxyCodeLine{}
\DoxyCodeLine{  std::size\_t size()\textcolor{keyword}{ const}\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} m\_data.size();}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  scalar\_t \& operator[](std::size\_t index)\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} m\_data[index];}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{const} scalar\_t \& operator[](std::size\_t index)\textcolor{keyword}{ const}\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} m\_data[index];}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{private}:}
\DoxyCodeLine{  std::vector<scalar\_t> m\_data;}
\DoxyCodeLine{\};}

\end{DoxyCode}
 Our custom vector class above is admittedly very simple. The key point we want to convey is that the {\ttfamily My\+Custom\+Vector} type is totally unknown to Pressio.\hypertarget{md_pages_ode_tutorial2_autotoc_md10}{}\doxysection{Problem Class}\label{md_pages_ode_tutorial2_autotoc_md10}
Here, we want to integrate in time the same system of ODEs shown in tutorial1, but now our problem is implemented using the {\ttfamily My\+Custom\+Vector} class as follows\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template}<\textcolor{keyword}{class} scalar\_t>}
\DoxyCodeLine{\textcolor{keyword}{struct }MySystem\{}
\DoxyCodeLine{  \textcolor{keyword}{using} scalar\_type   = scalar\_t;}
\DoxyCodeLine{  \textcolor{keyword}{using} state\_type    = MyCustomVector<scalar\_type>;}
\DoxyCodeLine{  \textcolor{keyword}{using} velocity\_type = state\_type;}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{keyword}{public}:}
\DoxyCodeLine{  \textcolor{keywordtype}{void} velocity(\textcolor{keyword}{const} state\_type \& y,}
\DoxyCodeLine{                scalar\_type t,}
\DoxyCodeLine{                velocity\_type \& rhs)\textcolor{keyword}{ const}}
\DoxyCodeLine{\textcolor{keyword}{  }\{}
\DoxyCodeLine{    constexpr scalar\_type ten\{10\};}
\DoxyCodeLine{    rhs[0] = ten * y[0];}
\DoxyCodeLine{    rhs[1] = ten * y[1];}
\DoxyCodeLine{    rhs[2] = ten * y[2];}
\DoxyCodeLine{  \};}
\DoxyCodeLine{}
\DoxyCodeLine{  velocity\_type createVelocity()\textcolor{keyword}{ const}\{}
\DoxyCodeLine{    \textcolor{keywordflow}{return} velocity\_type(3);}
\DoxyCodeLine{  \};}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md_pages_ode_tutorial2_autotoc_md11}{}\doxysection{Custom Ops Class}\label{md_pages_ode_tutorial2_autotoc_md11}
Because we are working with custom data types, we need to provide the necessary operations to do the algebra that pressio needs. This is done via an ops class as follows\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{template} <\textcolor{keyword}{typename} scalar\_t>}
\DoxyCodeLine{\textcolor{keyword}{struct }MyOps}
\DoxyCodeLine{\{}
\DoxyCodeLine{  \textcolor{keyword}{using} v\_t = MyCustomVector<scalar\_t>;}
\DoxyCodeLine{  \textcolor{keyword}{using} \textcolor{keywordtype}{size\_t} = \textcolor{keyword}{typename} v\_t::size\_type;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// compute: v = b*v1}}
\DoxyCodeLine{  \textcolor{keywordtype}{void} update(v\_t \& v, \textcolor{keyword}{const} v\_t \& v1, \textcolor{keyword}{const} scalar\_t b)\textcolor{keyword}{ const}}
\DoxyCodeLine{\textcolor{keyword}{  }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i=0; i<v.size(); ++i)\{}
\DoxyCodeLine{      v[i] = b*v1[i];}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// compute: v = a*v + b*v1}}
\DoxyCodeLine{  \textcolor{keywordtype}{void} update(v\_t \& v, \textcolor{keyword}{const} scalar\_t a,}
\DoxyCodeLine{          \textcolor{keyword}{const} v\_t \& v1, \textcolor{keyword}{const} scalar\_t b)\textcolor{keyword}{ const}}
\DoxyCodeLine{\textcolor{keyword}{  }\{}
\DoxyCodeLine{    \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i=0; i<v.size(); ++i)\{}
\DoxyCodeLine{      v[i] = a*v[i] + b*v1[i];}
\DoxyCodeLine{    \}}
\DoxyCodeLine{  \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
 The set of methods that this custom ops class needs to provide depend on the pressio functionality that you want to use. In this case, we only need the two overloads above because these are the only ones needed by the Euler forward. The list of ops needed for various time schemes is provided {\bfseries{missing}}.\hypertarget{md_pages_ode_tutorial2_autotoc_md12}{}\doxysection{Main function}\label{md_pages_ode_tutorial2_autotoc_md12}
Now that we have a problem and a custom ops, we can write the main\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} *argv[])}
\DoxyCodeLine{\{}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"{}Running tutorial\(\backslash\)n"{}};}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keyword}{using} scalar\_type = double;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// create the system/app object}}
\DoxyCodeLine{  \textcolor{keyword}{using} app\_t = MySystem<scalar\_type>;}
\DoxyCodeLine{  app\_t appObj;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// create and initialize the state}}
\DoxyCodeLine{  \textcolor{keyword}{using} native\_state\_t = \textcolor{keyword}{typename} app\_t::state\_type;}
\DoxyCodeLine{  \textcolor{keyword}{using} state\_t        = ::pressio::containers::Vector<native\_state\_t>;}
\DoxyCodeLine{  state\_t y(3);}
\DoxyCodeLine{  \textcolor{comment}{// pressio wrappers expose the data() method, returning a pointer to the wrapped object}}
\DoxyCodeLine{  \textcolor{keyword}{auto} \& yNative = *y.data();}
\DoxyCodeLine{  \textcolor{comment}{// we can use the subscript operator on the native std::vector}}
\DoxyCodeLine{  yNative[0] = 1.; yNative[1] = 2.; yNative[2] = 3.;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// instantiate the class performing operations}}
\DoxyCodeLine{  \textcolor{keyword}{using} my\_custom\_ops = MyOps<scalar\_type>;}
\DoxyCodeLine{  my\_custom\_ops ops;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// instantiate the stepper}}
\DoxyCodeLine{  \textcolor{keyword}{using} ode\_tag = ::pressio::ode::explicitmethods::Euler;}
\DoxyCodeLine{  \textcolor{keyword}{using} stepper\_t = ::pressio::ode::ExplicitStepper<ode\_tag, state\_t, app\_t, my\_custom\_ops>;}
\DoxyCodeLine{  stepper\_t stepperObj(y, appObj, ops);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// integrate in time}}
\DoxyCodeLine{  \textcolor{keyword}{const} scalar\_type dt = 0.1;}
\DoxyCodeLine{  \textcolor{keyword}{const} pressio::ode::types::step\_t numSteps = 1;}
\DoxyCodeLine{  ::pressio::ode::advanceNSteps(stepperObj, y, 0.0, dt, numSteps);}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{comment}{// check solution}}
\DoxyCodeLine{  std::cout << \textcolor{stringliteral}{"{}Computed solution: ["{}}}
\DoxyCodeLine{            << yNative[0] << \textcolor{stringliteral}{"{} "{}} << yNative[1] << \textcolor{stringliteral}{"{} "{}} << yNative[2] << \textcolor{stringliteral}{"{}] "{}}}
\DoxyCodeLine{        << \textcolor{stringliteral}{"{}Expected solution: [2,4,6] "{}}}
\DoxyCodeLine{        << std::endl;}
\DoxyCodeLine{}
\DoxyCodeLine{  \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\}}

\end{DoxyCode}
 Note how the custom ops object is passed to the stepper constructor. Pressio will introspect your ops class type to check if it is admissible for the target integration, and it will warn you at compile time if your ops class type does not have the right methods needed for the stepper you want.\hypertarget{md_pages_ode_tutorial2_autotoc_md13}{}\doxysection{Full Code}\label{md_pages_ode_tutorial2_autotoc_md13}
The full code is available \href{https://github.com/Pressio/pressio-tutorials/blob/main/tutorials/tut_ode_2.cc}{\texttt{ here}}. 